<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master - ฝึกพิมพ์แยกคำ</title>
    <style>
        :root {
            --bg-color: #323437;
            --main-color: #e2b714;
            --text-color: #646669;
            --sub-color: #d1d0c5;
            --error-color: #ca4754;
        }

        body {
            background-color: var(--bg-color);
            color: var(--sub-color);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #stats {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--main-color);
        }

        #word-display {
            max-width: 800px;
            font-size: 24px;
            line-height: 35px;
            margin-bottom: 20px;
            text-align: justify;
            word-wrap: break-word;
            user-select: none;
        }

        .word {
            display: inline-block;
            margin-right: 8px;
            color: var(--text-color);
        }

        .word.active {
            border-bottom: 2px solid var(--main-color);
        }

        .word.correct { color: var(--sub-color); }
        .word.incorrect { color: var(--error-color); }

        #input-field {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--text-color);
            color: var(--main-color);
            font-size: 24px;
            outline: none;
            width: 300px;
            text-align: center;
        }

        button {
            margin-top: 30px;
            padding: 10px 20px;
            background: var(--main-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <div id="stats">WPM: 0 | Accuracy: 0%</div>
    
    <div id="word-display">กำลังโหลดบทความ...</div>

    <input type="text" id="input-field" autofocus autocomplete="off">

    <button onclick="resetGame()">เปลี่ยนบทความ (New Game)</button>

    <script>
        const wordDisplay = document.getElementById('word-display');
        const inputField = document.getElementById('input-field');
        const statsDisplay = document.getElementById('stats');

        let words = [];
        let currentWordIndex = 0;
        let startTime = null;
        let mistakes = 0;
        let totalTyped = 0;

        // 1. ฟังก์ชันดึงบทความใหม่จาก API (สุ่มคำคมภาษาอังกฤษ)
        async function fetchArticle() {
            wordDisplay.innerHTML = "กำลังดึงข้อมูล...";
            try {
                const response = await fetch('https://api.quotable.io/random?minLength=150');
                const data = await response.json();
                words = data.content.split(' ');
                renderWords();
            } catch (error) {
                // ถ้า API ล่ม ให้ใช้ข้อความสำรอง
                const fallback = "The quick brown fox jumps over the lazy dog and runs away.";
                words = fallback.split(' ');
                renderWords();
            }
        }

        // 2. แสดงผลคำศัพท์ในหน้าจอ
        function renderWords() {
            wordDisplay.innerHTML = '';
            words.forEach((word, index) => {
                const span = document.createElement('span');
                span.innerText = word;
                span.classList.add('word');
                span.id = `word-${index}`;
                wordDisplay.appendChild(span);
            });
            highlightWord();
        }

        function highlightWord() {
            document.querySelectorAll('.word').forEach(el => el.classList.remove('active'));
            const activeWord = document.getElementById(`word-${currentWordIndex}`);
            if (activeWord) activeWord.classList.add('active');
        }

        // 3. ตรรกะการตรวจสอบการพิมพ์ (รายคำ)
        inputField.addEventListener('input', (e) => {
            if (!startTime) startTime = new Date();
            
            const typedValue = inputField.value;
            const currentWord = words[currentWordIndex];

            // ตรวจสอบเรียลไทม์: ถ้าพิมพ์ผิดให้แสดงสีแดงทันที
            const activeWordSpan = document.getElementById(`word-${currentWordIndex}`);
            if (!currentWord.startsWith(typedValue.trim())) {
                activeWordSpan.classList.add('incorrect');
            } else {
                activeWordSpan.classList.remove('incorrect');
            }

            // ถ้ากด Spacebar (หรือจบบทความ)
            if (typedValue.endsWith(' ')) {
                const finalTyped = typedValue.trim();
                
                if (finalTyped === currentWord) {
                    activeWordSpan.classList.replace('incorrect', 'correct');
                    activeWordSpan.classList.remove('active');
                    currentWordIndex++;
                    totalTyped++;
                    inputField.value = ''; // ล้างช่องพิมพ์
                    
                    if (currentWordIndex >= words.length) {
                        endGame();
                    } else {
                        highlightWord();
                    }
                } else {
                    mistakes++;
                }
                updateStats();
            }
        });

        function updateStats() {
            const timeElapsed = (new Date() - startTime) / 60000; // แปลงเป็นนาที
            const wpm = Math.round(currentWordIndex / timeElapsed) || 0;
            const accuracy = Math.round(((totalTyped - mistakes) / totalTyped) * 100) || 0;
            statsDisplay.innerText = `WPM: ${wpm} | Accuracy: ${accuracy < 0 ? 0 : accuracy}%`;
        }

        function resetGame() {
            currentWordIndex = 0;
            startTime = null;
            mistakes = 0;
            totalTyped = 0;
            inputField.value = '';
            statsDisplay.innerText = `WPM: 0 | Accuracy: 0%`;
            fetchArticle();
        }

        function endGame() {
            alert("ยินดีด้วย! คุณพิมพ์จบแล้ว\n" + statsDisplay.innerText);
            resetGame();
        }

        // เริ่มเกมครั้งแรก
        fetchArticle();
    </script>
</body>
</html>
